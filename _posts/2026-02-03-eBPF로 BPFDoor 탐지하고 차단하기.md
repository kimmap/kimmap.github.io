---
title: eBPFë¡œ BPFDoor íƒì§€í•˜ê³  ì°¨ë‹¨í•˜ê¸°
author: kimmap
date: 2026-02-03 09:00:00 +0900
categories: [Security]
tags: [ebpf, xdp, bpfdoor, linux]
---

## ë“¤ì–´ê°€ë©°

**BPFDoor**ëŠ” BPF(Berkeley Packet Filter)ë¥¼ ì•…ìš©í•˜ëŠ” ë¦¬ëˆ…ìŠ¤ ë°±ë„ì–´ì…ë‹ˆë‹¤. 

ìš°ë¦¬ë‚˜ë¼ì—ì„œëŠ” 2025ë…„ 4ì›” ë°œìƒí•œ **ëŒ€í˜• í†µì‹ ì‚¬ ìœ ì‹¬ ì •ë³´ ìœ ì¶œ ì‚¬ê³ **ì— ì‚¬ìš©ëœ í•´í‚¹ ë„êµ¬ë¡œ ì•Œë ¤ì ¸ ìˆìŠµë‹ˆë‹¤.



| í•­ëª© | ë‚´ìš© |
|------|------|
| í”¼í•´ ê·œëª¨ | ì•½ **2,696ë§Œ ê±´** ìœ ì‹¬ ì •ë³´ ìœ ì¶œ |
| ê°ì—¼ ì„œë²„ | 28ëŒ€ (ì•…ì„±ì½”ë“œ 33ì¢… ë°œê²¬) |
| ì ë³µ ê¸°ê°„ | 2022ë…„ 6ì›” ~ 2025ë…„ 4ì›” (**ì•½ 3ë…„**) |

<br/>


ì´ ê¸€ì—ì„œëŠ” **ë„¤íŠ¸ì›Œí¬ ë ˆë²¨**ì— ì§‘ì¤‘í•˜ì—¬ BPFDoorì˜ ë§¤ì§ íŒ¨í‚· ë™ì‘ì„ ë¶„ì„í•˜ê³ , **eBPF/XDP**ë¡œ íƒì§€ ë° ì°¨ë‹¨í•˜ëŠ” ë°©ë²•ì„ ë‹¤ë£¹ë‹ˆë‹¤.


(BPFDoorëŠ” BPF í•„í„° ì™¸ì—ë„ ìœ„ì¥ í”„ë¡œì„¸ìŠ¤, ìê°€ ë³µì œ í›„ ì‚­ì œ ë“± ë‹¤ì–‘í•œ íƒì§€ ìš°íšŒ ê¸°ë²•ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.)
<br/><br/>

> ğŸ’¡ **Note**  
> ì´ ê¸€ì—ì„œ ë‹¤ë£¨ëŠ” **BPFDoor-Defender** ì „ì²´ ì†ŒìŠ¤ ì½”ë“œëŠ” <br/>
> [GitHub - kimmap/ebpf-bpfdoor-defender](https://github.com/kimmap/ebpf-bpfdoor-defender)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
<br/><br/>

<br/><br/>
## 1. BPFDoor ë™ì‘ ì›ë¦¬

### 1.1 ì „ì²´ ì•„í‚¤í…ì²˜

BPFDoorì˜ ë™ì‘ì€ í¬ê²Œ ë‘ ë‹¨ê³„ë¡œ ë‚˜ë‰©ë‹ˆë‹¤:

```
1ë‹¨ê³„: ì ë³µ
BPFDoor í”„ë¡œì„¸ìŠ¤
    â”œâ”€â”€ RAW ì†Œì¼“ ìƒì„± (PF_PACKET, SOCK_RAW)
    â”œâ”€â”€ BPF í•„í„° ë¶€ì°© (SO_ATTACH_FILTER)
    â””â”€â”€ ë§¤ì§ íŒ¨í‚· ëŒ€ê¸° (ë¬´í•œ ë£¨í”„)

            â”‚
            â”‚ ë§¤ì§ íŒ¨í‚· ìˆ˜ì‹ 
            â–¼

2ë‹¨ê³„: í™œì„±í™”
    â”‚
    â”œâ”€â”€ ê³µê²©ì <â”€â”€â”€ ë¦¬ë²„ìŠ¤ ì‰˜ ì—°ê²° â”€â”€â”€ Target
    â”‚
    â””â”€â”€ ë˜ëŠ”: ê³µê²©ì â”€â”€> iptables ì¡°ì‘ â”€â”€> ë°”ì¸ë“œ ì‰˜
```

**ë¦¬ë²„ìŠ¤ ì‰˜ ì›ë¦¬ (dup2):**
```c
// ì†Œì¼“ fdë¥¼ í‘œì¤€ ì…ì¶œë ¥ìœ¼ë¡œ ë³µì œ
dup2(sockfd, STDIN_FILENO);   // ì†Œì¼“ â†’ í‘œì¤€ ì…ë ¥
dup2(sockfd, STDOUT_FILENO);  // ì†Œì¼“ â†’ í‘œì¤€ ì¶œë ¥
dup2(sockfd, STDERR_FILENO);  // ì†Œì¼“ â†’ í‘œì¤€ ì—ëŸ¬
execl("/bin/sh", "sh", NULL); // ì‰˜ ì‹¤í–‰ â†’ ëª¨ë“  ì…ì¶œë ¥ì´ ê³µê²©ìì—ê²Œ ì „ë‹¬
```

### 1.2 ì™œ íƒì§€ê°€ ì–´ë ¤ìš´ê°€?

ì¼ë°˜ì ì¸ ë°±ë„ì–´ì™€ BPFDoorì˜ ì°¨ì´ì :

| í•­ëª© | ì¼ë°˜ ë°±ë„ì–´ | BPFDoor |
|------|-----------|---------|
| ë¦¬ìŠ¤ë‹ í¬íŠ¸ | ì—´ë¦¼ (ì˜ˆ: 4444) | **ì—†ìŒ** |
| netstat íƒì§€ | ê°€ëŠ¥ | **ë¶ˆê°€ëŠ¥** |
| ë°©í™”ë²½ ìš°íšŒ | ì–´ë ¤ì›€ | **ì‰¬ì›€** |
| íŠ¸ë˜í”½ íŠ¹ì„± | ì§€ì†ì  ì—°ê²° | **ë‹¨ë°œì„± íŠ¸ë¦¬ê±°** |


BPFDoorëŠ” RAW ì†Œì¼“ì„ ì‚¬ìš©í•˜ì—¬ **ëª¨ë“  IP íŒ¨í‚·ì˜ ë³µì‚¬ë³¸**ì„ ìˆ˜ì‹ í•©ë‹ˆë‹¤. 
ì»¤ë„ ìˆ˜ì¤€ì—ì„œ BPF í•„í„°ê°€ ë§¤ì§ íŒ¨í‚·ë§Œ ê³¨ë¼ë‚´ë¯€ë¡œ, ìœ ì €ìŠ¤í˜ì´ìŠ¤ì—ì„œëŠ” ê´€ë ¨ í¬íŠ¸ê°€ ì „í˜€ ë³´ì´ì§€ ì•ŠìŠµë‹ˆë‹¤.



## 2. ë§¤ì§ íŒ¨í‚· êµ¬ì¡° ë¶„ì„

### 2.1 íŒ¨í‚· ìº¡ì²˜

tcpdumpë¡œ ì‹¤ì œ BPFDoor ë§¤ì§ íŒ¨í‚·ì„ ìº¡ì²˜í•´ ë³´ì•˜ìŠµë‹ˆë‹¤:

```
07:24:10.913005 IP 192.168.57.101.47857 > 192.168.57.100.29269: UDP, length 24
    0x0000:  4500 0034 719a 4000 4011 d504 c0a8 3965  E..4q.@.@.....9e
    0x0010:  c0a8 3964 baf1 7255 0020 1ca0 7255 0000  ..9d..rU....rU..
    0x0020:  ffff ffff 2329 6a75 7374 666f 7266 756e  ....#)justforfun
    0x0030:  0000 0000                                ....
```

### 2.2 íŒ¨í‚· êµ¬ì¡° ë¶„ì„

#### IP í—¤ë” (20 bytes)

```
4500 0034 719a 4000 4011 d504 c0a8 3965 c0a8 3964
â”‚â”‚â”‚â”‚ â”‚â”‚â”‚â”‚                     â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚ â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚
â”‚â”‚â”‚â”‚ â”‚â”‚â”‚â”‚                     â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”´â”€ Dst: 192.168.57.100
â”‚â”‚â”‚â”‚ â”‚â”‚â”‚â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Src: 192.168.57.101
â”‚â”‚â”‚â”‚ â””â”´â”´â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Total Length: 52
â””â”´â”´â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ IPv4, IHL=5
```

#### UDP í—¤ë” (8 bytes)

```
baf1 7255 0020 1ca0
â”‚â”‚â”‚â”‚ â”‚â”‚â”‚â”‚ â”‚â”‚â”‚â”‚
â”‚â”‚â”‚â”‚ â”‚â”‚â”‚â”‚ â””â”´â”´â”´â”€â”€â”€ Length: 32 bytes
â”‚â”‚â”‚â”‚ â””â”´â”´â”´â”€â”€â”€â”€â”€â”€â”€â”€ Dst Port: 29269 (0x7255) â˜… íŠ¸ë¦¬ê±° í¬íŠ¸
â””â”´â”´â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Src Port: 47857 (ì„ì˜)
```

#### ë§¤ì§ íŒ¨í‚· í˜ì´ë¡œë“œ (24 bytes)

BPFDoorê°€ ì •ì˜í•œ `magic_packet` êµ¬ì¡°ì²´:

```c
struct magic_packet {
    unsigned int    flag;     // 4 bytes - ë§¤ì§ í”Œë˜ê·¸
    in_addr_t       ip;       // 4 bytes - ì½œë°± IP
    unsigned short  port;     // 2 bytes - ì½œë°± í¬íŠ¸
    char            pass[14]; // 14 bytes - íŒ¨ìŠ¤ì›Œë“œ
} __attribute__ ((packed));
```

ì‹¤ì œ ë°ì´í„° ë§¤í•‘:

```
7255 0000 ffff ffff 2329 6a75 7374 666f 7266 756e 0000 0000
â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚ â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚ â”‚â”‚â”‚â”‚ â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚
â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚ â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚ â”‚â”‚â”‚â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€ pass: "justforfun"
â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚ â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚ â””â”´â”´â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  port: 9001
â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  ip: 0xFFFFFFFF (src ì‚¬ìš©)
â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  flag: 0x72550000 â˜…
```

### 2.3 í•µì‹¬ íƒì§€ ì‹œê·¸ë‹ˆì²˜

| í•„ë“œ | ê°’ | ì„¤ëª… |
|------|-----|------|
| UDP Dst Port | `29269` (0x7255) | íŠ¸ë¦¬ê±° í¬íŠ¸ |
| Payload[0:4] | `0x72550000` | ë§¤ì§ í”Œë˜ê·¸ |
| Payload[4:8] | `0xFFFFFFFF` | ì½œë°± IP (íŒ¨í‚· src ì‚¬ìš©) |
| Payload[8:10] | ê°€ë³€ | ì½œë°± í¬íŠ¸ |
| Payload[10:24] | ê°€ë³€ | ì¸ì¦ íŒ¨ìŠ¤ì›Œë“œ |



## 3. BPF í•„í„° ì½”ë“œ ë¶„ì„

BPFDoorëŠ” classic BPF(cBPF) í•„í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ë§¤ì§ íŒ¨í‚·ë§Œ ì„ ë³„í•©ë‹ˆë‹¤.

### 3.1 í•„í„° ì½”ë“œ ì›ë³¸

```c
struct sock_filter bpf_code[] = {
    { 0x28, 0, 0, 0x0000000c },   // [0]  A = EtherType
    { 0x15, 0, 27, 0x00000800 },  // [1]  if (A != IP) goto REJECT
    { 0x30, 0, 0, 0x00000017 },   // [2]  A = IP.Protocol
    { 0x15, 0, 5, 0x00000011 },   // [3]  if (A != UDP) goto ICMP_CHECK
    { 0x28, 0, 0, 0x00000014 },   // [4]  A = IP.FragOffset
    { 0x45, 23, 0, 0x00001fff },  // [5]  if (fragmented) goto REJECT
    { 0xb1, 0, 0, 0x0000000e },   // [6]  X = IP.HeaderLen
    { 0x48, 0, 0, 0x00000016 },   // [7]  A = Payload[0:2]
    { 0x15, 19, 20, 0x00007255 }, // [8]  if (A == 0x7255) ACCEPT else REJECT
    // ... ICMP, TCP ì²´í¬ ìƒëµ ...
    { 0x6, 0, 0, 0x0000ffff },    // [28] return ACCEPT
    { 0x6, 0, 0, 0x00000000 },    // [29] return REJECT
};
```

### 3.2 í•µì‹¬ ë¡œì§ í•´ì„

```
EtherType ì²´í¬
    â”‚
    â”œâ”€â”€ != 0x0800 (IP) â”€â”€> REJECT
    â”‚
    â””â”€â”€ == 0x0800 (IP)
            â”‚
            â–¼
        Protocol ì²´í¬
            â”‚
            â”œâ”€â”€ UDP(17)  â”€â”€> Fragment? â”€â”€> Payload[0:2] == 0x7255? â”€â”€> ACCEPT
            â”‚
            â”œâ”€â”€ ICMP(1)  â”€â”€> Fragment? â”€â”€> Payload[0:2] == 0x7255? â”€â”€> ACCEPT
            â”‚
            â””â”€â”€ TCP(6)   â”€â”€> Fragment? â”€â”€> Payload[0:2] == 0x5293? â”€â”€> ACCEPT
```

### 3.3 í”„ë¡œí† ì½œë³„ ë§¤ì§ ê°’

| í”„ë¡œí† ì½œ | ë§¤ì§ ê°’ | ìœ„ì¹˜ |
|---------|--------|------|
| **UDP** | `0x7255` | í˜ì´ë¡œë“œ ì²« 2ë°”ì´íŠ¸ |
| **ICMP** | `0x7255` | ë°ì´í„° ì²« 2ë°”ì´íŠ¸ |
| **TCP** | `0x5293` | í˜ì´ë¡œë“œ ì²« 2ë°”ì´íŠ¸ |




## 4. ì‹¤ì œ ê³µê²©/ë°©ì–´ í…ŒìŠ¤íŠ¸

### 4.1 í…ŒìŠ¤íŠ¸ í™˜ê²½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Attacker     â”‚  â”€â”€â”€â”€â”€â”€ UDP Magic Packet â”€â”€â”€â”€â”€â”€>   â”‚     Target        â”‚
â”‚ 192.168.57.101  â”‚  <â”€â”€â”€â”€â”€ Reverse Shell â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚ 192.168.57.100    â”‚
â”‚                 â”‚                                    â”‚ (bpfdoor_defender)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- **VM 2ëŒ€**: VirtualBox + Vagrant
- **OS**: Rocky Linux 9.4
- **Kernel**: 5.14.0-427.13.1.el9_4.x86_64

---

### 4.2 Case 1: ë°©ì–´ ì‹œìŠ¤í…œ ì—†ìŒ (ê³µê²© ì„±ê³µ)

Defenderê°€ ì—†ëŠ” ìƒíƒœì—ì„œ ê³µê²©ì„ ìˆ˜í–‰í•˜ë©´ ë¦¬ë²„ìŠ¤ ì‰˜ì´ ì„±ê³µì ìœ¼ë¡œ ì—°ê²°ë©ë‹ˆë‹¤.

**[Target] BPFDoor ì‹¤í–‰:**
```bash
$ git clone https://github.com/gwillgues/BPFDoor.git
$ gcc -o bpfdoor bpfdoor.c
$ ./bpfdoor --init
```

**[Attacker] ê³µê²© ì‹¤í–‰:**

> **Note**: ê³µê²© í”„ë¡œê·¸ë¨(`bpfdoor_attacker`)ì€ í…ŒìŠ¤íŠ¸ ëª©ì ìœ¼ë¡œ ë³„ë„ ì‘ì„±í•˜ì˜€ìœ¼ë©°, ì•…ìš© ìœ„í—˜ì´ ìˆì–´ ê³µê°œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

```bash
$ ./bpfdoor_attacker --target-ip 192.168.57.100
[INFO] Executing Reverse Shell Attack against 192.168.57.100
[INFO] Listening for reverse shell on local port: 9001
[INFO] UDP Magic packet sent (src_port:0 -> 192.168.57.100:29269) with password 'justforfun'
[INFO] Reverse shell connection accepted from 192.168.57.100:50418
[INFO] Read and discarded initial handshake: "3458"
[INFO] Starting interactive shell I/O (RC4 encrypted)...

[root@target /]$ whoami
root
```

**[Target] tcpdumpë¡œ ë§¤ì§ íŒ¨í‚· í™•ì¸:**
```bash
$ tcpdump -i eth1 -nn 'udp and port 29269' -X
08:02:46.822257 IP 192.168.57.101.41864 > 192.168.57.100.29269: UDP, length 24
    0x0000:  4500 0034 5b34 4000 4011 eb6a c0a8 3965  E..4[4@.@..j..9e
    0x0010:  c0a8 3964 a388 7255 0020 3409 7255 0000  ..9d..rU..4.rU..
    0x0020:  ffff ffff 2329 6a75 7374 666f 7266 756e  ....#)justforfun
    0x0030:  0000 0000                                ....
```
**ê²°ê³¼:** ë§¤ì§ íŒ¨í‚· í•˜ë‚˜ë¡œ **root ê¶Œí•œì˜ ì•”í˜¸í™”ëœ ë¦¬ë²„ìŠ¤ ì‰˜** íšë“

---

### 4.3 Case 2: Defender í™œì„±í™” (ê³µê²© ì°¨ë‹¨)

> ğŸ’¡ **Note**  
> **BPFDoor-Defender** ì „ì²´ ì†ŒìŠ¤ ì½”ë“œëŠ” <br/>
> [GitHub - kimmap/ebpf-bpfdoor-defender](https://github.com/kimmap/ebpf-bpfdoor-defender)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
<br/>
#### Step 1: eBPF í”„ë¡œê·¸ë¨ ì»´íŒŒì¼

```bash
$ clang -O2 -g -target bpf -c bpfdoor_defender.bpf.c -o bpfdoor_defender.bpf.o

$ file bpfdoor_defender.bpf.o
bpfdoor_defender.bpf.o: ELF 64-bit LSB relocatable, eBPF, version 1 (SYSV), with debug_info, not stripped
```

#### Step 2: eBPF ë°”ì´íŠ¸ì½”ë“œ í™•ì¸ (ì„ íƒ)

```bash
$ llvm-objdump -S bpfdoor_defender.bpf.o

Disassembly of section xdp:

0000000000000000 <bpfdoor_defender>:
;     if (bpf_ntohs(eth->h_proto) == ETH_P_IP);
       7:       56 02 29 00 08 00 00 00 if w2 != 0x8 goto +0x29
;     return (iph->protocol == IPPROTO_UDP);
      18:       56 02 1e 00 11 00 00 00 if w2 != 0x11 goto +0x1e
;     return (bpf_ntohs(*magic) == BPFDOOR_MAGIC);
      43:       56 01 05 00 72 55 00 00 if w1 != 0x5572 goto +0x5  # 0x7255 ë§¤ì§!
;     bpf_printk("BPFDOOR: Magic packet detected! DROP");
      47:       85 00 00 00 06 00 00 00 call 0x6
      48:       b4 00 00 00 01 00 00 00 w0 = 0x1  # XDP_DROP
```

#### Step 3: XDP í”„ë¡œê·¸ë¨ Attach

```bash
# attach ì „ - bpfdoor_defender ì—†ìŒ
$ bpftool prog list | grep xdp
(ì—†ìŒ)

# XDP attach
$ ip link set dev eth1 xdp obj bpfdoor_defender.bpf.o sec xdp

# attach í›„ - id 49ë¡œ ë¡œë“œë¨
$ bpftool prog list | grep -A3 "xdp.*bpfdoor"
49: xdp  name bpfdoor_defender  tag 6c59633e1a31ba4a  gpl
        loaded_at 2026-02-03T08:10:02+0900  uid 0
        xlated 400B  jited 263B  memlock 4096B  map_ids 13
        btf_id 77
```

#### Step 4: í”„ë¡œê·¸ë¨ ìƒì„¸ ì •ë³´

```bash
$ bpftool prog show id 49 --pretty
{
    "id": 49,
    "type": "xdp",
    "name": "bpfdoor_defender",
    "tag": "6c59633e1a31ba4a",
    "gpl_compatible": true,
    "jited": true,
    "bytes_xlated": 400,
    "bytes_jited": 263
}

$ bpftool net list
xdp:
eth1(3) generic id 49
```

#### Step 5: ê³µê²© ì‹œë„ ë° íƒì§€

**[Attacker]**
```bash
$ ./bpfdoor_attacker --target-ip 192.168.57.100
[INFO] UDP Magic packet sent (src_port:0 -> 192.168.57.100:29269)
[INFO] Waiting for reverse shell connection or timeout...
# ì—°ê²° íƒ€ì„ì•„ì›ƒ - íŒ¨í‚·ì´ DROPë¨
```

**[Target] íƒì§€ ë¡œê·¸:**
```bash
$ cat /sys/kernel/debug/tracing/trace_pipe
<idle>-0  [000] ..s2.  1885.217886: bpf_trace_printk: BPFDOOR: Magic packet detected! DROP
```

**[Target] tcpdump - XDPì—ì„œ DROPë˜ì–´ íŒ¨í‚· ì•ˆ ë³´ì„:**
```bash
$ tcpdump -i eth1 -nn 'udp and port 29269'
listening on eth1, link-type EN10MB (Ethernet), snapshot length 262144 bytes
# (íŒ¨í‚· ì—†ìŒ - XDPì—ì„œ ì»¤ë„ ìŠ¤íƒ ë„ë‹¬ ì „ DROP)
```

---

### 4.4 ê²°ê³¼ ë¹„êµ

| í•­ëª© | Defender OFF | Defender ON |
|------|-------------|-------------|
| Magic Packet ë„ë‹¬ | âœ… ì»¤ë„ í†µê³¼ | âŒ XDPì—ì„œ DROP |
| ë¦¬ë²„ìŠ¤ ì‰˜ ì—°ê²° | âœ… ì„±ê³µ | âŒ íƒ€ì„ì•„ì›ƒ |
| tcpdump íƒì§€ | âœ… íŒ¨í‚· ë³´ì„ | âŒ íŒ¨í‚· ì•ˆ ë³´ì„ |
| ê³µê²© ì†Œìš” ì‹œê°„ | ~5ms | N/A (ì°¨ë‹¨) |

**XDPì˜ ê°•ì :** ì»¤ë„ ë„¤íŠ¸ì›Œí¬ ìŠ¤íƒì— ë„ë‹¬í•˜ê¸° ì „ì— DROPí•˜ë¯€ë¡œ, tcpdumpë¡œë„ íŒ¨í‚·ì„ ë³¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.



## 5. ê²°ë¡  ë° ì¶”ê°€ íƒì§€ ë°©ì•ˆ

### 5.1 êµ¬í˜„ ê²°ê³¼

eBPFë¥¼ í™œìš©í•˜ì—¬ BPFDoorì˜ ë§¤ì§ íŒ¨í‚·ì„ **ì»¤ë„ ìˆ˜ì¤€ì—ì„œ íƒì§€í•˜ê³  ì°¨ë‹¨**í•˜ëŠ” ì‹œìŠ¤í…œì„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

| í•­ëª© | ê²°ê³¼ |
|------|------|
| UDP ë§¤ì§ íŒ¨í‚· íƒì§€ | âœ… |
| ì‹¤ì‹œê°„ íŒ¨í‚· DROP | âœ… |
| ì´ë²¤íŠ¸ ë¡œê¹… | âœ… |
| í†µê³„ ìˆ˜ì§‘ | âœ… |

### 5.2 ë§ˆë¬´ë¦¬

BPFDoorëŠ” BPF ê¸°ìˆ ì„ êµë¬˜í•˜ê²Œ ì•…ìš©í•œ ë°±ë„ì–´ì…ë‹ˆë‹¤. 

í•˜ì§€ë§Œ ê°™ì€ ê¸°ìˆ ì˜ ë°œì „í˜•ì¸ **eBPF**ë¥¼ ì‚¬ìš©í•˜ë©´ ì»¤ë„ ìˆ˜ì¤€ì—ì„œ íš¨ê³¼ì ìœ¼ë¡œ íƒì§€í•˜ê³  ì°¨ë‹¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


---

## ì°¸ê³  ìë£Œ
- [ebpf-bpfdoor-defender GitHub Repository](https://github.com/kimmap/ebpf-bpfdoor-defender)
- [Learning eBPF (Liz Rice)](https://cilium.isovalent.com/hubfs/Learning-eBPF%20-%20Full%20book.pdf)
- [learning-ebpf GitHub Repository](https://github.com/lizrice/learning-ebpf)
